{
    "Title": "Codeforces Round 1048 (Div. 1)",
    "Source": "codeforces",
    "Name": "Maple and Tree Beauty (Hard Version)",
    "Time Limit": "6 s",
    "Memory Limit": "1024 mb",
    "Problem Statement": "これは問題の難しいバージョンです。バージョン間の違いは、このバージョンでは$t$と$n$の制約が大きいことです。この問題のすべてのバージョンを解決した場合にのみ、ハッキングが可能です。\nMapleは、$1$から$n$まで番号付けされた$n$個の頂点から成る根付き木を与えられます。根のインデックスは$1$です。木の各頂点には、0または1のラベルが付けられています。残念ながら、Mapleは頂点のラベルを忘れてしまい、ちょうど$k$個のゼロと$n - k$個の1があることだけを思い出しています。\n各頂点について、頂点の名前を根からその頂点までの頂点のラベルを連結して形成されるバイナリ文字列として定義します。より厳密には、$\\text{name}_1 = \\text{label}_1$であり、すべての$2≤ u≤ n$に対して、$\\text{name}_u = \\text{name}_{p_u} + \\text{label}_u$とします。ここで、$p_u$は頂点$u$の親であり、$+$は文字列の連結を表します。\n木の美しさは、すべての葉の名前の最長共通部分列$^{\\text{∗}}$の長さに等しいです。あなたのタスクは、ちょうど$k$個のゼロと$n - k$個の1を持つ木のすべてのラベリングの中で最大の美しさを決定することです。\n$^{\\text{∗}}$列$a$が列$b$の部分列であるのは、$a$が$b$の任意の位置からのいくつかの（0個またはすべての場合も含む）要素を削除することによって得られる場合です。文字列$s_1, s_2, ... s_m$の最長共通部分列は、すべての$s_1, s_2, ..., s_m$の部分列である最長文字列です。\n$^{\\text{†}}$葉は子を持たない任意の頂点です。",
    "Statement Images": [],
    "Constraints": "Time limit: 6 s\nMemory limit: 1024 mb",
    "IO Styles": "入力\n各テストは複数のテストケースを含みます。最初の行にはテストケースの数 $t$ ($1 ≤ t ≤ 10^4$) が含まれます。テストケースの説明が続きます。\n各テストケースの最初の行には、頂点の数 $n$ と、ゼロでラベル付けされた頂点の数 $k$ ($2 ≤ n ≤ 2\\cdot 10^5, 0 ≤ k ≤ n$) という2つの整数が含まれます。\n2行目には $n - 1$ の整数 $p_2, p_3, ..., p_{n}$ ($1 ≤ p_i ≤ i - 1$) が含まれます。これは頂点 $i$ の親を表します。\nすべてのテストケースに対する $n$ の合計は $2 \\cdot 10^5$ を超えないことが保証されています。\n出力\n各テストケースについて、ちょうど $k$ 個のゼロと $n - k$ 個の一がある木のラベル付けの中で最大の美しさを表す整数を出力してください。",
    "Sample Detail": [
        {
            "input": "5\n7 3\n1 1 2 2 3 3\n7 2\n1 1 2 3 1 1\n5 0\n1 2 3 4\n5 2\n1 1 1 1\n5 4\n1 1 1 1",
            "output": "3\n2\n5\n1\n2",
            "explanation": "",
            "images": []
        }
    ],
    "Notes": "注意 ![image](1.png)  最初のテストケースでは、最大の美しさは $3$ で、頂点が $[0, 0, 0, 1, 1, 1, 1]$ とラベル付けされているとき、最長共通部分列は 001 です。 ![image](2.png)  二つ目のテストケースでは、最大の美しさは $2$ で、頂点が $[1, 0, 0, 1, 1, 1, 1]$ とラベル付けされているとき、最長共通部分列は 11 です。",
    "Note Images": [
        "https://espresso.codeforces.com/1f47a18ed60774e1e086fda1e69e6a508ece64a4.png",
        "https://espresso.codeforces.com/f2f618bf41cbf9ec7e446bf2fd42534266263584.png"
    ],
    "Language": "jp"
}