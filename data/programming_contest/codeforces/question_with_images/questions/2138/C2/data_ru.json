{
    "Title": "Specific Tasks",
    "Source": "codeforces",
    "Name": "C2",
    "Time Limit": "unknown",
    "Memory Limit": "unknown",
    "Problem Statement": "Это сложная версия задачи. Отличие между версиями заключается в том, что в этой версии ограничения на $t$ и $n$ выше. Вы можете делать взломы только в том случае, если решили все версии этой задачи. \nМейпл дано корневое дерево, состоящее из $n$ вершин, пронумерованных от $1$ до $n$, где корень имеет индекс $1$. Каждая вершина дерева помечена либо нулем, либо единицей. К сожалению, Мейпл забыла, как помечены вершины, и только помнит, что есть ровно $k$ нулей и $n - k$ единиц.\nДля каждой вершины определим имя вершины как двоичную строку, образованную конкатенацией меток вершин от корня до вершины. Более формально, $\\text{name}_1 = \\text{label}_1$ и $\\text{name}_u = \\text{name}_{p_u} + \\text{label}_u$ для всех $2≤ u≤ n$, где $p_u$ — родитель вершины $u$, а $+$ обозначает собой конкатенацию строк.\nКрасота дерева равна длине наибольшей общей подпоследовательности$^{\\text{∗}}$ имен всех листьев$^{\\text{†}}$. Ваша задача — определить максимальную красоту среди всех возможных распределений меток на дереве с ровно $k$ нулями и $n - k$ единицами.\n$^{\\text{∗}}$Последовательность $a$ является подпоследовательностью $b$, если $a$ может быть получена из $b$ удалением нескольких (возможно, ни одного или всех) элементов на произвольных позициях. Наибольшая общая подпоследовательность строк $s_1, s_2, ... s_m$ — это самая длинная строка, которая является подпоследовательностью всех $s_1, s_2, ..., s_m$.\n$^{\\text{†}}$Листом называется любая вершина, у которой нет детей.",
    "Statement Images": [],
    "Constraints": "Time limit: unknown\nMemory limit: unknown",
    "IO Styles": "Входные данные\nКаждый тест состоит из нескольких наборов входных данных. В первой строке находится одно целое число $t$ ($1 ≤ t ≤ 10^4$) — количество наборов входных данных. Далее следует описание наборов входных данных. \nПервая строка каждого набора входных данных содержит два целых числа $n$ и $k$ ($2 ≤ n ≤ 2\\cdot 10 ^ 5$, $0 ≤ k ≤ n$) — количество вершин и количество вершин, помеченных нулем, соответственно.\nВторая строка содержит $n - 1$ целых чисел $p_2, p_3, ..., p_{n}$ ($1 ≤ p_i ≤ i - 1$) — родитель вершины $i$.\nГарантируется, что сумма значений $n$ по всем наборам входных данных не превосходит $2 \\cdot 10^5$. \nВыходные данные\nДля каждого набора входных данных выведите одно целое число, представляющее максимальную красоту среди всех возможных распределений меток на дереве с ровно $k$ нулями и $n - k$ единицами.",
    "Sample Detail": [
        {
            "input": "5\n7 3\n1 1 2 2 3 3\n7 2\n1 1 2 3 1 1\n5 0\n1 2 3 4\n5 2\n1 1 1 1\n5 4\n1 1 1 1",
            "output": "3\n2\n5\n1\n2",
            "explanation": "",
            "images": []
        }
    ],
    "Notes": "Примечание ![image](1.png)  В первом наборе входных данных максимальная красота равна $3$, когда вершины помечены как $[0, 0, 0, 1, 1, 1, 1]$, и наибольшая общая подпоследовательность равна 001. ![image](2.png)  Во втором наборе входных данных максимальная красота равна $2$, когда вершины помечены как $[1, 0, 0, 1, 1, 1, 1]$, и наибольшая общая подпоследовательность равна 11.",
    "Note Images": [
        "https://espresso.codeforces.com/1f47a18ed60774e1e086fda1e69e6a508ece64a4.png",
        "https://espresso.codeforces.com/f2f618bf41cbf9ec7e446bf2fd42534266263584.png"
    ],
    "Language": "ru"
}