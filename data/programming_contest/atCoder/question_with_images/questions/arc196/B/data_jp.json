{
    "Title": "AtCoder Regular Contest 196 (Div. 1)",
    "Source": "atcoder",
    "Name": "Torus Loop",
    "Time Limit": "2 sec",
    "Memory Limit": "1024 MiB",
    "Problem Statement": "H 行 W 列のグリッドがあります。\n行には上から順に 0,1,..., H-1 の番号が、列には左から順に 0,1,...,W-1 の番号がついています。\n行 i、列 j のマスをマス (i,j) と表すことにします。\nH 個の文字列 S_0, S_1, ..., S_{H-1} が与えられます。それぞれの文字列は A と B のみからなる長さ W の文字列です。\n各マスには、以下の 2 種類のタイルのいずれかを配置します。S_i の j+1 文字目 (0≤ j ≤ W-1) を S_{ij} としたとき、マス (i,j) に配置するタイルの種類は S_{ij} です。\n- 種類 A：タイルの表面に、隣接する 2 辺の中点どうしを結ぶ線分が一本描かれている\n![image](1.png)\n- 種類 B：タイルの表面に、向かい合う 2 辺の中点どうしを結ぶ線分が一本描かれている\n![image](2.png)\nタイルは自由に回転可能です。タイルの表面に描かれた線分のみに注目したとき、種類 A のタイルを回転する方法は 4 通り、種類 B のタイルを回転する方法は 2 通りあります。よって、線分が作る模様のみによってタイルの配置方法を区別したとき、タイルを配置する方法の数は、種類 A のタイルの数 a、種類 B のタイルの数 b を用いて、\n4^a\\times 2^b 通りと表されます。\nこのうち、グリッドをトーラスとして見たときにタイルに描かれた線分が行き止まりを持たないようにタイルを配置する方法の数を 998244353 で割ったあまりを出力してください。\nここで、グリッドをトーラスとして見たときにタイルに描かれた線分が行き止まりを持たないとは、具体的には、すべてのマス (i,j) について以下の 2 条件をともに満たすことを言います。\n- 次の 2 つが、両方とも存在する、あるいはどちらも存在しない。\n- マス (i,j) のタイルの右辺の中点を端点とする、マス (i,j) のタイルの表面に描かれた線分\n- マス (i,(j+1)\\bmod W) のタイルの左辺の中点を端点とする、マス (i,(j+1)\\bmod W) のタイルの表面に描かれた線分\n- 次の 2 つが、両方とも存在する、あるいはどちらも存在しない。\n- マス (i,j) のタイルの下辺の中点を端点とする、マス (i,j) のタイルの表面に描かれた線分\n- マス ((i+1)\\bmod H,j) のタイルの上辺の中点を端点とする、マス ((i+1)\\bmod H,j) のタイルの表面に描かれた線分\n例えば、次の配置方法は条件を満たします。\n![image](3.png)\n次の配置方法は条件を満たしません。具体的には、マス (0,2) のタイルの右辺の中点を端点とする線分が存在しないのに対し、マス (0,0) のタイルの左辺の中点を端点とする線分は存在するので、条件を満たしません。\n![image](4.png)\nT 個のテストケースが与えられるので、それぞれについて解いてください。",
    "Statement Images": [
        "https://img.atcoder.jp/arc196/A.png",
        "https://img.atcoder.jp/arc196/B.png",
        "https://img.atcoder.jp/arc196/ok.png",
        "https://img.atcoder.jp/arc196/ng.png"
    ],
    "Constraints": "- 1 ≤ T ≤ 10^5\n- 2 ≤ H,W\n- HW≤ 10^6\n- S_i\\,(0≤ i≤ H-1) は A と B のみからなる長さ W の文字列\n- すべてのテストケースにわたる HW の総和は 10^6 以下\n- T, H, W は整数",
    "IO Styles": "入力\n入力は以下の形式で標準入力から与えられる。\nT\ncase_1\ncase_2\n\\vdots\ncase_T\n各ケースは以下の形式で与えられる。\nH W\nS_0\nS_1\n\\vdots\nS_{H-1}\n出力\n各テストケースに対する、問題文中の条件を満たすタイルの配置方法の数を 998244353 で割ったあまりを改行区切りで出力せよ。",
    "Sample Detail": [
        {
            "input": "3\n3 3\nAAB\nAAB\nBBB\n3 3\nBBA\nABA\nAAB\n3 4\nBAAB\nBABA\nBBAA\n",
            "output": "2\n0\n2\n",
            "explanation": "1 番目のテストケースにおける正しい配置の一つの例として、以下の画像のようにタイルを配置する方法があります。\n\n![image](5.png)",
            "images": [
                "https://img.atcoder.jp/arc196/sample.png"
            ]
        }
    ],
    "Language": "jp"
}