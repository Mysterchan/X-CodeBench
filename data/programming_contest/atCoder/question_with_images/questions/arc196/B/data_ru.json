{
    "Title": "AtCoder Regular Contest 196 (Div. 1)",
    "Source": "atcoder",
    "Name": "Torus Loop",
    "Time Limit": "2 sec",
    "Memory Limit": "1024 MiB",
    "Problem Statement": "Входные данные\nДано поле из H строк и W столбцов.\nСтроки пронумерованы от 0 до H-1 сверху вниз, а столбцы - от 0 до W-1 слева направо.\nПусть (i,j) обозначает ячейку в строке i и столбце j.\nВам даны H строк S_0, S_1, ..., S_{H-1}, каждая из которых имеет длину W и состоит из символов A и B.\nВ каждой ячейке помещен один из двух типов плиток.\nПусть S_{ij} обозначает (j+1)-й символ (0 ≤ j ≤ W-1) строки S_i. Тип плитки, размещенной в ячейке (i,j), равен S_{ij}.\n- Тип A: На поверхности плитки нарисован один отрезок, соединяющий середины двух соседних сторон.\n![image](1.png)\n- Тип B: На поверхности плитки нарисован один отрезок, соединяющий середины двух противоположных сторон.\n![image](2.png)\nЭти плитки могут свободно вращаться. Если рассматривать только узор, формируемый отрезками, то для плитки типа A существует четыре способа вращения, а для плитки типа B - два способа вращения. Следовательно, если мы различаем размещения только по узору отрезков, количество способов размещения плиток равно 4^a × 2^b, где a - количество плиток типа A, а b - количество плиток типа B.\nСреди этих способов выведите число, по модулю 998244353, способов так, чтобы отрезки на плитках не имели тупиков, если рассматривать поле как тор. \nЗдесь \"отрезки на плитках не имеют тупиков, если рассматривать поле как тор\", означает, что выполняются следующие два условия для каждой ячейки (i,j):\n- Должны существовать оба следующих условия или ни одно из них:\n- отрезок, нарисованный в ячейке (i,j), чья конечная точка - середина правой стороны ячейки (i,j)\n- отрезок, нарисованный в ячейке (i,(j+1) \\bmod W), чья конечная точка - середина левой стороны ячейки (i,(j+1) \\bmod W)\n- Должны существовать оба следующих условия или ни одно из них:\n- отрезок, нарисованный в ячейке (i,j), чья конечная точка - середина нижней стороны ячейки (i,j)\n- отрезок, нарисованный в ячейке ((i+1) \\bmod H,j), чья конечная точка - середина верхней стороны ячейки ((i+1) \\bmod H,j)\nНапример, следующее размещение удовлетворяет условию:\n![image](3.png)\nСледующее размещение не удовлетворяет условию. В частности, хотя нет отрезка, чей конечная точка - середина правой стороны плитки в ячейке (0,2), есть отрезок, чей конечная точка - середина левой стороны плитки в ячейке (0,0), поэтому условие не выполняется.\n![image](4.png)\nВам даны T тестовых случаев; решите каждый из них.",
    "Statement Images": [
        "https://img.atcoder.jp/arc196/A.png",
        "https://img.atcoder.jp/arc196/B.png",
        "https://img.atcoder.jp/arc196/ok.png",
        "https://img.atcoder.jp/arc196/ng.png"
    ],
    "Constraints": "- $1 ≤ T ≤ 10^5$\n- $2 ≤ H,W$\n- $HW≤ 10^6$\n- $S_i\\,(0≤ i≤ H-1)$ — это строки длины $W$, состоящие из A и B.\n- Сумма $H \\cdot W$ по всем тестовым случаям не превышает $10^6$.\n- $T$, $H$ и $W$ — целые числа.",
    "IO Styles": "Входные данные\nВходные данные поступают из стандартного ввода в следующем формате:\nT\ncase_1\ncase_2\n\\vdots\ncase_T\nКаждый набор данных имеет следующий формат:\nH W\nS_0\nS_1\n\\vdots\nS_{H-1}\nВыходные данные\nДля каждого тестового случая выведите число, взятое по модулю 998244353, размещений, удовлетворяющих условию, в отдельных строках.",
    "Sample Detail": [
        {
            "input": "3\n3 3\nAAB\nAAB\nBBB\n3 3\nBBA\nABA\nAAB\n3 4\nBAAB\nBABA\nBBAA\n",
            "output": "2\n0\n2\n",
            "explanation": "Одно допустимое размещение для первого теста показано на следующем изображении:\n\n![image](5.png)",
            "images": [
                "https://img.atcoder.jp/arc196/sample.png"
            ]
        }
    ],
    "Language": "ru"
}