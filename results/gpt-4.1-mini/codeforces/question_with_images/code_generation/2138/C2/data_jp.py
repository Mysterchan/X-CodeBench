import sys
sys.setrecursionlimit(10**7)
input = sys.stdin.readline

t = int(input())
# 全テストケースのnの合計は2*10^5以下なので、合計でO(n)の処理が必要

for _ in range(t):
    n, k = map(int, input().split())
    parents = list(map(int, input().split()))
    # 木の構築
    g = [[] for __ in range(n+1)]
    for i, p in enumerate(parents, start=2):
        g[p].append(i)

    # 葉の集合を求める
    leaves = [i for i in range(1, n+1) if len(g[i]) == 0]

    # 問題の本質：
    # 各頂点uの名前は根からuまでのラベルの連結
    # 葉の名前の最長共通部分列の長さを最大化したい
    #
    # ラベルは0がk個、1がn-k個で割り当てる
    #
    # 最長共通部分列(LCS)は、葉の名前の全てに共通する部分列の最大長
    #
    # 名前は根から葉へのパスのラベル列
    #
    # 最長共通部分列は、葉の名前の全てに共通する部分列なので、
    # それは葉の名前の全てに現れる文字の並び
    #
    # ここで、名前は根からのパスなので、名前の長さは葉の深さ+1
    #
    # 最長共通部分列は、葉の名前の全てに共通する部分列なので、
    # それは葉の名前の全てに現れる文字の並び
    #
    # つまり、葉の名前の全てに共通する部分列の長さは、
    # 葉の名前の全てに共通する文字の並びの長さの最大値
    #
    # しかし、部分列なので、連続している必要はない
    #
    # ここで、葉の名前は根から葉へのパスのラベル列
    #
    # すべての葉の名前の最長共通部分列の長さは、
    # 根から葉へのパスの中で、すべての葉のパスに共通して現れる文字の並びの最大長
    #
    # つまり、葉の名前の最長共通部分列は、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並びの最大長
    #
    # ここで、部分列なので、パスの中の文字を飛ばしてもよい
    #
    # したがって、葉の名前の最長共通部分列は、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並びの最大長
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並びの最大長
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並びの最大長
    #
    # ここで、ラベルは0と1の割り当てで、0がk個、1がn-k個
    #
    # すべての葉の名前の最長共通部分列の長さを最大化するには、
    # すべての葉のパスに共通して現れる文字の並びの長さを最大化する必要がある
    #
    # すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # ここで、すべての葉のパスに共通して現れる文字の並びは、
    # 木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # つまり、木の根から葉までのパスの中で、すべての葉のパスに共通して現れる文字の並び
    #
    # これは、木の根から葉までのパスの中で、すべての葉