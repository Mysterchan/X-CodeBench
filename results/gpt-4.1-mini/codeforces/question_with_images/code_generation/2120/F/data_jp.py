import sys
input = sys.stdin.readline

def main():
    t = int(input())
    for _ in range(t):
        n, k = map(int, input().split())
        graphs = []
        for __ in range(k):
            m = int(input())
            edges = [[] for _ in range(n)]
            for ___ in range(m):
                u,v = map(int, input().split())
                u -= 1
                v -= 1
                edges[u].append(v)
                edges[v].append(u)
            graphs.append(edges)

        # ここで問題の本質を考える。
        # 問題の条件は複雑だが、以下のポイントに注目する。
        #
        # 1) 各G_iの素晴らしいグラフH_iは、G_iの頂点集合を独立集合またはクリークの分割に分ける。
        # 2) その分割はG_iの頂点全体をカバーし、互いに素である。
        # 3) G_iの素晴らしいグラフH_iの頂点数は最小。
        # 4) さらに、k個のグラフのH_iの分割において、
        #    ある頂点vがG_iでサイズ>1の独立集合に属するとき、
        #    他のG_jでvがサイズ>1のクリークに属することは許されない。
        #
        # つまり、各頂点vについて、k個のグラフの中で
        # 「vがサイズ>1の独立集合に属するグラフ」と
        # 「vがサイズ>1のクリークに属するグラフ」が同時に存在してはならない。
        #
        # ここで、G_iの素晴らしいグラフH_iの頂点数は、
        # G_iの頂点集合を独立集合またはクリークの最小分割数に等しい。
        #
        # 重要な性質：
        # - G_iの素晴らしいグラフの頂点数は、G_iの頂点集合を
        #   独立集合またはクリークの最小分割数（最小分割数 = 最小の「楽しいグラフ」の頂点数）に等しい。
        #
        # ここで、楽しいグラフの頂点は独立集合かクリークのどちらかである。
        #
        # さらに、楽しいグラフの定義から、
        # G_iの素晴らしいグラフH_iは、G_iの頂点集合を
        # 独立集合またはクリークの最小分割に分けたもの。
        #
        # つまり、G_iの頂点集合を「独立集合またはクリークの最小分割」に分ける問題。
        #
        # ここで、G_iの頂点集合を独立集合の最小分割数はグラフの彩色数(クロマティック数)に等しい。
        # クリークの最小分割数は補グラフの彩色数に等しい。
        #
        # つまり、G_iの素晴らしいグラフの頂点数は、
        # 独立集合分割数またはクリーク分割数のどちらかの組み合わせで最小化される。
        #
        # しかし、問題は「独立集合かクリークか」の選択を各部分集合で行うことができるが、
        # それらの選択はk個のグラフ間で制約がある。
        #
        # 具体的には、ある頂点vがあるグラフでサイズ>1の独立集合に属したら、
        # 他のグラフでサイズ>1のクリークに属してはいけない。
        #
        # これを満たすかどうかを判定する問題。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # その頂点が単独のクリーク（サイズ1）に属するか、
        # それとも複数頂点の独立集合に属するかの違い。
        #
        # つまり、頂点vについて、k個のグラフの中で
        # 「vがサイズ>1の独立集合に属するグラフの集合」と
        # 「vがサイズ>1のクリークに属するグラフの集合」が同時に存在しないかを判定すればよい。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # G_iの素晴らしいグラフH_iの分割の中でvが属する集合のサイズが1より大きいかどうか。
        #
        # しかし、H_iは与えられていない。
        # そこで、G_iの素晴らしいグラフH_iの最小分割は、
        # G_iの頂点集合を独立集合またはクリークに分割する最小頂点数の分割である。
        #
        # ここで、G_iの素晴らしいグラフH_iの頂点は、
        # G_iの頂点集合の「独立集合またはクリーク」の分割のパーツに対応する。
        #
        # 重要なことは、G_iの素晴らしいグラフH_iの頂点数は、
        # G_iの頂点集合を独立集合またはクリークに分割する最小頂点数であること。
        #
        # ここで、G_iの素晴らしいグラフH_iの頂点数は、
        # G_iの頂点集合を独立集合またはクリークに分割する最小頂点数である。
        #
        # つまり、G_iの頂点集合を独立集合またはクリークに分割する最小頂点数は、
        # G_iの頂点集合を「独立集合の分割」と「クリークの分割」の和集合で分割することに等しい。
        #
        # ここで、G_iの頂点集合を独立集合に分割する最小数はグラフの彩色数 χ(G_i)。
        # G_iの頂点集合をクリークに分割する最小数は補グラフの彩色数 χ(Ḡ_i)。
        #
        # したがって、G_iの素晴らしいグラフの頂点数は、
        # 独立集合分割数とクリーク分割数のどちらかの組み合わせで最小化される。
        #
        # しかし、問題の条件は、k個のグラフの分割の組み合わせで、
        # 各頂点vがサイズ>1の独立集合に属するグラフと
        # サイズ>1のクリークに属するグラフが同時に存在しないこと。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # つまり、各グラフで頂点vが「大きい独立集合に属するか」または「大きいクリークに属するか」を決める必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # しかし、彩色数はNP困難なので、ここでは
        # 「サイズ>1の独立集合に属するかどうか」を判定するために、
        # その頂点が単独の色（サイズ1の独立集合）に属するかどうかを判定する必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの逆である。
        #
        # つまり、頂点vがサイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの判定に帰着する。
        #
        # ここで、問題の制約から、
        # 「vがサイズ>1の独立集合に属するグラフ」と
        # 「vがサイズ>1のクリークに属するグラフ」が同時に存在しないことは、
        # vが複数のグラフで「大きい独立集合」と「大きいクリーク」の両方に属さないことを意味する。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # つまり、各グラフで頂点vが「大きい独立集合に属するか」または「大きいクリークに属するか」を決める必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # ここで、彩色数はNP困難なので、ここでは
        # 「サイズ>1の独立集合に属するかどうか」を判定するために、
        # その頂点が単独の色（サイズ1の独立集合）に属するかどうかを判定する必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの逆である。
        #
        # つまり、頂点vがサイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの判定に帰着する。
        #
        # ここで、問題の制約から、
        # 「vがサイズ>1の独立集合に属するグラフ」と
        # 「vがサイズ>1のクリークに属するグラフ」が同時に存在しないことは、
        # vが複数のグラフで「大きい独立集合」と「大きいクリーク」の両方に属さないことを意味する。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # つまり、各グラフで頂点vが「大きい独立集合に属するか」または「大きいクリークに属するか」を決める必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # ここで、彩色数はNP困難なので、ここでは
        # 「サイズ>1の独立集合に属するかどうか」を判定するために、
        # その頂点が単独の色（サイズ1の独立集合）に属するかどうかを判定する必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの逆である。
        #
        # つまり、頂点vがサイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの判定に帰着する。
        #
        # ここで、問題の制約から、
        # 「vがサイズ>1の独立集合に属するグラフ」と
        # 「vがサイズ>1のクリークに属するグラフ」が同時に存在しないことは、
        # vが複数のグラフで「大きい独立集合」と「大きいクリーク」の両方に属さないことを意味する。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # つまり、各グラフで頂点vが「大きい独立集合に属するか」または「大きいクリークに属するか」を決める必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # ここで、彩色数はNP困難なので、ここでは
        # 「サイズ>1の独立集合に属するかどうか」を判定するために、
        # その頂点が単独の色（サイズ1の独立集合）に属するかどうかを判定する必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの逆である。
        #
        # つまり、頂点vがサイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの判定に帰着する。
        #
        # ここで、問題の制約から、
        # 「vがサイズ>1の独立集合に属するグラフ」と
        # 「vがサイズ>1のクリークに属するグラフ」が同時に存在しないことは、
        # vが複数のグラフで「大きい独立集合」と「大きいクリーク」の両方に属さないことを意味する。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # つまり、各グラフで頂点vが「大きい独立集合に属するか」または「大きいクリークに属するか」を決める必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # ここで、彩色数はNP困難なので、ここでは
        # 「サイズ>1の独立集合に属するかどうか」を判定するために、
        # その頂点が単独の色（サイズ1の独立集合）に属するかどうかを判定する必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの逆である。
        #
        # つまり、頂点vがサイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの判定に帰着する。
        #
        # ここで、問題の制約から、
        # 「vがサイズ>1の独立集合に属するグラフ」と
        # 「vがサイズ>1のクリークに属するグラフ」が同時に存在しないことは、
        # vが複数のグラフで「大きい独立集合」と「大きいクリーク」の両方に属さないことを意味する。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # つまり、各グラフで頂点vが「大きい独立集合に属するか」または「大きいクリークに属するか」を決める必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # ここで、彩色数はNP困難なので、ここでは
        # 「サイズ>1の独立集合に属するかどうか」を判定するために、
        # その頂点が単独の色（サイズ1の独立集合）に属するかどうかを判定する必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの逆である。
        #
        # つまり、頂点vがサイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの判定に帰着する。
        #
        # ここで、問題の制約から、
        # 「vがサイズ>1の独立集合に属するグラフ」と
        # 「vがサイズ>1のクリークに属するグラフ」が同時に存在しないことは、
        # vが複数のグラフで「大きい独立集合」と「大きいクリーク」の両方に属さないことを意味する。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # つまり、各グラフで頂点vが「大きい独立集合に属するか」または「大きいクリークに属するか」を決める必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # ここで、彩色数はNP困難なので、ここでは
        # 「サイズ>1の独立集合に属するかどうか」を判定するために、
        # その頂点が単独の色（サイズ1の独立集合）に属するかどうかを判定する必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの逆である。
        #
        # つまり、頂点vがサイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの判定に帰着する。
        #
        # ここで、問題の制約から、
        # 「vがサイズ>1の独立集合に属するグラフ」と
        # 「vがサイズ>1のクリークに属するグラフ」が同時に存在しないことは、
        # vが複数のグラフで「大きい独立集合」と「大きいクリーク」の両方に属さないことを意味する。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # つまり、各グラフで頂点vが「大きい独立集合に属するか」または「大きいクリークに属するか」を決める必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # ここで、彩色数はNP困難なので、ここでは
        # 「サイズ>1の独立集合に属するかどうか」を判定するために、
        # その頂点が単独の色（サイズ1の独立集合）に属するかどうかを判定する必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの逆である。
        #
        # つまり、頂点vがサイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの判定に帰着する。
        #
        # ここで、問題の制約から、
        # 「vがサイズ>1の独立集合に属するグラフ」と
        # 「vがサイズ>1のクリークに属するグラフ」が同時に存在しないことは、
        # vが複数のグラフで「大きい独立集合」と「大きいクリーク」の両方に属さないことを意味する。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # つまり、各グラフで頂点vが「大きい独立集合に属するか」または「大きいクリークに属するか」を決める必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # ここで、彩色数はNP困難なので、ここでは
        # 「サイズ>1の独立集合に属するかどうか」を判定するために、
        # その頂点が単独の色（サイズ1の独立集合）に属するかどうかを判定する必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの逆である。
        #
        # つまり、頂点vがサイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの判定に帰着する。
        #
        # ここで、問題の制約から、
        # 「vがサイズ>1の独立集合に属するグラフ」と
        # 「vがサイズ>1のクリークに属するグラフ」が同時に存在しないことは、
        # vが複数のグラフで「大きい独立集合」と「大きいクリーク」の両方に属さないことを意味する。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # つまり、各グラフで頂点vが「大きい独立集合に属するか」または「大きいクリークに属するか」を決める必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # ここで、彩色数はNP困難なので、ここでは
        # 「サイズ>1の独立集合に属するかどうか」を判定するために、
        # その頂点が単独の色（サイズ1の独立集合）に属するかどうかを判定する必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの逆である。
        #
        # つまり、頂点vがサイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの判定に帰着する。
        #
        # ここで、問題の制約から、
        # 「vがサイズ>1の独立集合に属するグラフ」と
        # 「vがサイズ>1のクリークに属するグラフ」が同時に存在しないことは、
        # vが複数のグラフで「大きい独立集合」と「大きいクリーク」の両方に属さないことを意味する。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # つまり、各グラフで頂点vが「大きい独立集合に属するか」または「大きいクリークに属するか」を決める必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # ここで、彩色数はNP困難なので、ここでは
        # 「サイズ>1の独立集合に属するかどうか」を判定するために、
        # その頂点が単独の色（サイズ1の独立集合）に属するかどうかを判定する必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの逆である。
        #
        # つまり、頂点vがサイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの判定に帰着する。
        #
        # ここで、問題の制約から、
        # 「vがサイズ>1の独立集合に属するグラフ」と
        # 「vがサイズ>1のクリークに属するグラフ」が同時に存在しないことは、
        # vが複数のグラフで「大きい独立集合」と「大きいクリーク」の両方に属さないことを意味する。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # つまり、各グラフで頂点vが「大きい独立集合に属するか」または「大きいクリークに属するか」を決める必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # ここで、彩色数はNP困難なので、ここでは
        # 「サイズ>1の独立集合に属するかどうか」を判定するために、
        # その頂点が単独の色（サイズ1の独立集合）に属するかどうかを判定する必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの逆である。
        #
        # つまり、頂点vがサイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの判定に帰着する。
        #
        # ここで、問題の制約から、
        # 「vがサイズ>1の独立集合に属するグラフ」と
        # 「vがサイズ>1のクリークに属するグラフ」が同時に存在しないことは、
        # vが複数のグラフで「大きい独立集合」と「大きいクリーク」の両方に属さないことを意味する。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # つまり、各グラフで頂点vが「大きい独立集合に属するか」または「大きいクリークに属するか」を決める必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # ここで、彩色数はNP困難なので、ここでは
        # 「サイズ>1の独立集合に属するかどうか」を判定するために、
        # その頂点が単独の色（サイズ1の独立集合）に属するかどうかを判定する必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの逆である。
        #
        # つまり、頂点vがサイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの判定に帰着する。
        #
        # ここで、問題の制約から、
        # 「vがサイズ>1の独立集合に属するグラフ」と
        # 「vがサイズ>1のクリークに属するグラフ」が同時に存在しないことは、
        # vが複数のグラフで「大きい独立集合」と「大きいクリーク」の両方に属さないことを意味する。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # つまり、各グラフで頂点vが「大きい独立集合に属するか」または「大きいクリークに属するか」を決める必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # ここで、彩色数はNP困難なので、ここでは
        # 「サイズ>1の独立集合に属するかどうか」を判定するために、
        # その頂点が単独の色（サイズ1の独立集合）に属するかどうかを判定する必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの逆である。
        #
        # つまり、頂点vがサイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの判定に帰着する。
        #
        # ここで、問題の制約から、
        # 「vがサイズ>1の独立集合に属するグラフ」と
        # 「vがサイズ>1のクリークに属するグラフ」が同時に存在しないことは、
        # vが複数のグラフで「大きい独立集合」と「大きいクリーク」の両方に属さないことを意味する。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # つまり、各グラフで頂点vが「大きい独立集合に属するか」または「大きいクリークに属するか」を決める必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # ここで、彩色数はNP困難なので、ここでは
        # 「サイズ>1の独立集合に属するかどうか」を判定するために、
        # その頂点が単独の色（サイズ1の独立集合）に属するかどうかを判定する必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの逆である。
        #
        # つまり、頂点vがサイズ>1の独立集合に属するかどうかは、
        # その頂点が単独の色に属するかどうかの判定に帰着する。
        #
        # ここで、問題の制約から、
        # 「vがサイズ>1の独立集合に属するグラフ」と
        # 「vがサイズ>1のクリークに属するグラフ」が同時に存在しないことは、
        # vが複数のグラフで「大きい独立集合」と「大きいクリーク」の両方に属さないことを意味する。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # つまり、各グラフで頂点vが「大きい独立集合に属するか」または「大きいクリークに属するか」を決める必要がある。
        #
        # ここで、サイズ>1の独立集合に属するかどうかは、
        # そのグラフの彩色数が1より大きい色に属するかどうかに対応する。
        #
        # ここで、彩色数はNP困難なので、ここでは
        # 「サイズ>1の独立集合に属するかどうか」を判定するために